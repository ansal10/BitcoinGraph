<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script type="text/javascript">
//  setTimeout(function () { location.reload(true); }, 15000);
</script>
<script src="moment.js"></script>
<body>

<div ng-app="myApp" ng-controller="myCtrl" >
    <span style="align-content: center">StartTime</span>
    <span>EndTime</span>
    <div id="container" style="width:100%; height:800px;"></div>

</div>

</body>

<script>
    $(function () {


});
</script>

<script>
    var app = angular.module('myApp', []);
    app.controller('myCtrl', function($scope) {

        var colors = {
            zebpay: "#3498DB",
            bci: "#F4D03F",
            coinbase: "#000000",
            coinsecure: "#CB4335"
        };
        var visible_graphs = ['zebpay-buy', 'bci-sells', 'zebpay-sells', 'bci-buy', 'coinsecure-buy', 'coinsecure-sells', 'coinbase-buy'];
        function readData() {
            return $.ajax({
                type: "GET",
                url: 'data.json',
                async: false
            }).responseText;
        }

        var data = readData();
        data = JSON.parse(data);

        var chartData = {
            chart: {
                type: 'spline'
            },
            title: {
                text: 'Bitcoin Prices'
            },
            xAxis: {
                categories: []
            },
            yAxis: {
                title: {
                    text: 'Fruit eaten'
                }
            },
            series: []
        };
        draftChart(data, moment().subtract(2, 'hours'), moment().add(1, 'minutes'));





        function getDatas( datas, from, to) {
           var data =  _.select(datas, function (price_data) {
                var timestmap =  moment(price_data.timestamp);
                return (timestmap >= from && timestmap <= to)
            }).map(function(price_data){
                return price_data.price;
            })
            return data;
        }

        function draftChart(data, from, to) {
            chartData.series = [];
            for(var wallet in data){
                for(var price_type in data[wallet]){
                    var name = wallet + '-' + price_type;
                    var datas =data[wallet][price_type];
                    var visible = visible_graphs.indexOf(name) >= 0;
                    chartData.series.push({
                        color: colors[wallet],
                        name: name,
                        data: getDatas(datas,  from, to ),
                        visible:visible
                    })
                }
            }
            Highcharts.chart('container', chartData);
        }
    });
</script>
</html>